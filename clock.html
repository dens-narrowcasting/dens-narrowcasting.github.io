<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Helmond Clock & Weather</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      color: white;
    }

    .image-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: -1;
      filter: brightness(0.8);
    }

    .logo {
      position: absolute;
      top: 2.5vh;
      right: 2.5vw;
      width: 23vw;
      height: auto;
      z-index: 1;
    }

    .info-container {
      position: absolute;
      bottom: 3vh;
      left: 3vw;
      background: rgba(0, 0, 0, 0.55);
      padding: 2.5vh 3vw;
      border-radius: 1vw;
      font-size: 1.3vw;
      line-height: 1.6em;
      box-shadow: 0 0 2vw rgba(0, 0, 0, 0.4);
    }

    .time {
      font-size: 2.5vw;
      font-weight: bold;
    }

    .date {
      font-size: 1.2vw;
      margin-top: 0.8vh;
    }

    .week {
      font-size: 1.1vw;
      margin-top: 0.5vh;
    }

    .weather {
      font-size: 1.2vw;
      margin-top: 1vh;
      line-height: 1.5em;
    }

    .time, .date, .week, .weather {
      text-shadow: 2px 2px 8px rgba(0,0,0,0.8);
    }
  </style>
</head>
<body>
  <div class="image-bg" id="bg"></div>
  <img class="logo" src="https://www.dens.one/wp-content/uploads/2024/06/dens-logo-white.svg" alt="DENS Logo">
  <div class="info-container">
    <div class="time" id="time"></div>
    <div class="date" id="date"></div>
    <div class="week" id="week"></div>
    <div class="weather" id="weather"></div>
  </div>

  <script>
    function updateClock() {
      const now = new Date();
      const options = {
        timeZone: 'Europe/Amsterdam',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      };
      const timeString = new Intl.DateTimeFormat('en-GB', options).format(now);

      const dateOptions = {
        timeZone: 'Europe/Amsterdam',
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      };
      const dateString = new Intl.DateTimeFormat('en-GB', dateOptions).format(now);

      const amsNow = new Date(now.toLocaleString('en-US', { timeZone: 'Europe/Amsterdam' }));
      const jan1 = new Date(amsNow.getFullYear(), 0, 1);
      const days = Math.floor((amsNow - jan1) / (24 * 60 * 60 * 1000));
      const weekNumber = Math.ceil((days + jan1.getDay() + 1) / 7);

      document.getElementById('time').textContent = timeString;
      document.getElementById('date').textContent = dateString;
      document.getElementById('week').textContent = `Week ${weekNumber}`;
    }

    async function updateWeather() {
      const lat = 51.479;
      const lon = 5.661;
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,relative_humidity_2m,weathercode&hourly=weathercode&timezone=Europe%2FAmsterdam`;

      try {
        const response = await fetch(url);
        const data = await response.json();
        const current = data.current;

        const temp = current.temperature_2m;
        const feels = current.apparent_temperature;
        const humidity = current.relative_humidity_2m;
        const code = current.weathercode;

        const { description, emoji } = getWeatherDescription(code);
        let weatherText = `${emoji} Helmond: ${description}, ${temp}Â°C (feels like ${feels}Â°C), humidity ${humidity}%`;

        const now = new Date();
        const amsHour = now.toLocaleString('en-US', { timeZone: 'Europe/Amsterdam', hour: '2-digit', hour12: false });
        const nextHourIndex = data.hourly.time.findIndex(t => t.includes(`T${amsHour}:00`)) + 1;
        const nextCode = data.hourly.weathercode[nextHourIndex];

        if ([51, 53, 55, 61, 63, 65, 71, 73, 75, 80, 81, 82].includes(nextCode)) {
          weatherText += " âš ï¸ Rain expected within the next hour. Consider taking an umbrella.";
        }

        document.getElementById('weather').textContent = weatherText;
      } catch (error) {
        document.getElementById('weather').textContent = "ðŸŒ Weather data not available.";
      }
    }

    function getWeatherDescription(code) {
      const map = {
        0: { description: "Clear sky", emoji: "â˜€ï¸" },
        1: { description: "Mainly clear", emoji: "ðŸŒ¤ï¸" },
        2: { description: "Partly cloudy", emoji: "â›…" },
        3: { description: "Overcast", emoji: "â˜ï¸" },
        45: { description: "Fog", emoji: "ðŸŒ«ï¸" },
        48: { description: "Freezing fog", emoji: "ðŸŒ«ï¸â„ï¸" },
        51: { description: "Light drizzle", emoji: "ðŸŒ¦ï¸" },
        53: { description: "Drizzle", emoji: "ðŸŒ¦ï¸" },
        55: { description: "Dense drizzle", emoji: "ðŸŒ§ï¸" },
        61: { description: "Light rain", emoji: "ðŸŒ¦ï¸" },
        63: { description: "Rain", emoji: "ðŸŒ§ï¸" },
        65: { description: "Heavy rain", emoji: "ðŸŒ§ï¸ðŸ’§" },
        71: { description: "Light snow", emoji: "ðŸŒ¨ï¸" },
        73: { description: "Snow", emoji: "â„ï¸" },
        75: { description: "Heavy snow", emoji: "â„ï¸ðŸŒ¨ï¸" },
        80: { description: "Light showers", emoji: "ðŸŒ¦ï¸" },
        81: { description: "Showers", emoji: "ðŸŒ§ï¸" },
        82: { description: "Heavy showers", emoji: "ðŸŒ§ï¸ðŸ’¦" }
      };
      return map[code] || { description: "Unknown weather", emoji: "â”" };
    }

    const backgrounds = [
      "https://dens-narrowcasting.github.io/dens_powerhub.png",
      "https://dens-narrowcasting.github.io/extra%20edit%20hoge%20resolutie%20-%20dens%20logo-01.jpg",
      "https://dens-narrowcasting.github.io/Ruben-zoon%20Media%20(12).jpeg"
    ];

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    let shuffledBackgrounds = shuffle([...backgrounds]);
    let currentBgIndex = 0;

    function changeBackground() {
      const bgDiv = document.getElementById('bg');
      bgDiv.style.backgroundImage = `url("${shuffledBackgrounds[currentBgIndex]}")`;
      currentBgIndex = (currentBgIndex + 1) % shuffledBackgrounds.length;
      if (currentBgIndex === 0) shuffledBackgrounds = shuffle([...backgrounds]);
    }

    setInterval(updateClock, 1000);
    setInterval(updateWeather, 600000);
    setInterval(changeBackground, 10000);
    updateClock();
    updateWeather();
    changeBackground();
  </script>
</body>
</html>
